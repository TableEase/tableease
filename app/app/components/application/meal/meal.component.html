<div *ngIf="allDataFetched">
  <div *ngIf="restaurantExists;then restaurant else norestaurant">
  </div>
</div>

<ng-template #norestaurant>
  <div>First
    <a routerLink="/app/restaurant"> create a restaurant</a> before creating a menu.</div>
</ng-template>
<ng-template #restaurant>
  <button *ngIf="meals" class="btn btn-primary" (click)="addModal=true">Add Item</button>
  Restaurant:
  <select (change)="getMenu()" [(ngModel)]="selectedRestaurant" required>
    <option *ngFor="let r of restaurants" [ngValue]="r">{{r.name}} - {{r.address.address}}</option>
  </select>

  <clr-stack-view>
    <clr-stack-header class="cap">
    </clr-stack-header>
    <div *ngFor="let meal of meals">

      <clr-stack-block>

        <clr-stack-label>{{meal.name}}</clr-stack-label>
        <div class="flexMe">
          <clr-stack-content>{{meal.description}}</clr-stack-content>
          <clr-stack-content>
            <a (click)="editModal = true; onReadMeal(meal)">
              <clr-icon shape="pencil"></clr-icon>
            </a>
          </clr-stack-content>
        </div>

        <clr-stack-block>
          <clr-stack-label>Allergies</clr-stack-label>
          <clr-stack-content *ngIf="meal.allergies.length > 0">
            <span *ngFor="let allergy of meal.allergies;let last=last;let i = index">{{allergy.name}}{{last ? '' : (i==meal.allergies.length-2) ? ' and ' : ', '}}</span>
          </clr-stack-content>
        </clr-stack-block>

        <clr-stack-block>
          <clr-stack-label>Price</clr-stack-label>
          <clr-stack-content>${{meal.price}}</clr-stack-content>
        </clr-stack-block>

      </clr-stack-block>

    </div>

  </clr-stack-view>
</ng-template>

<clr-modal [(clrModalOpen)]="editModal">
  <h3 class="modal-title" *ngIf="editModal">{{mealToEdit.name}}</h3>
  <div class="modal-body">
    <app-meal-form *ngIf="editModal" [meal]="mealToEdit"></app-meal-form>
  </div>
  <div class="modal-footer pr-0">
    <button type="button" class="btn btn-outline btn-sm" (click)="editModal = false; onUpdateMeal()">Update
    </button>
    <button type="button" class="btn btn-danger btn-sm" (click)="editModal = false; doubleCheck=true">Delete</button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="doubleCheck">
  <h3 class="modal-title">Confirm delete confirmation</h3>
  <h4 class="modal-body" *ngIf="doubleCheck">Are you sure you want to remove {{mealToEdit.name}}?</h4>
  <div class="modal-footer">
    <button type="button" class="btn btn-secondary btn-sm" (click)="doubleCheck=false; editModal=true">Return</button>
    <button type="button" class="btn btn-danger btn-sm" (click)="doubleCheck=false; onDeleteMeal(mealToEdit)">Confirm
    </button>
  </div>
</clr-modal>

<clr-modal [(clrModalOpen)]="addModal">
  <h3 class="modal-title" *ngIf="addModal">Add A Dish</h3>
  <div class="modal-body">
    <app-meal-form *ngIf="addModal"></app-meal-form>
  </div>

  <div class="modal-footer pr-0">
    <button type="button" class="btn btn-outline btn-sm" (click)="addModal = false; onCreateMeal()">Submit</button>
    <button type="button" class="btn btn-warning btn-sm" (click)="onClear()">Clear</button>
  </div>

</clr-modal>